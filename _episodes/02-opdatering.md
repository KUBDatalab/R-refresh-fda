---
# Please do not edit this file directly; it is auto generated.
# Instead, please edit 02-opdatering.md in _episodes_rmd/
title: "Pakker og opdatering"
teaching: 10
exercises: 5
questions:
- "Hvad nu hvis min R ikke er opdateret?"
- "Hvordan udvider jeg hvad R kan?"
- "Hvordan får jeg fat på ggbiplot når github siger nej?"
objectives:
- "Lær at opdatere R og pakker"
- "Få installeret ggbiplot"
keypoints:
- "Pakker udvider hvad R kan"
- "Pakker kan hentes mere end et sted fra"
- "Hold R og pakkerne opdateret! Men opdater i starten af kurset - ikke lige før eksamen!"

source: Rmd
---





# Pakker

## Installation og indlæsning
Pakker i R er samlinger af funktioner som kan være nyttige i forskellige sammenhænge. De fleste pakker vi får brug for, er samlet på `CRAN`, "The Comprehensive R Archive Network". Disse pakker, er blevet udsat for et minimum
af kvalitetskontrol. Det er ingen garantier for at de fungerer som vi forventer, men sandsynligheden er ret høj.

Når vi skal bruge en pakke til vores programmering, skal vi gøre to ting.

1. Installere pakken på computeren. 
2. Indlæse pakken i R.

Pakker fra `CRAN` installeres på computeren på denne måde:


~~~
install.packages("devtools")
~~~
{: .language-r}

Vi angiver navnet på pakken som en tekststreng. install.packages() funktionen søger efter navnet, og finder den noget, installeres pakken på vores computer.

I dette tilfælde er det pakken `devtools` en samling af værktøjer der er nyttige når man udvikler ny funktionalitet i R. Men pakken indeholder andet der kan være nyttigt i dette kursus. Dette ser vi nærmere på senere.

Når pakken så er installeret på computeren kan vi endnu ikke bruge den i RStudio. Den skal først indlæses. Dette kan gøres med funktionen library().


~~~
library(devtools)
~~~
{: .language-r}

Bemærk at her skal der ikke anførselstegn rundt om pakkenavnet. Dette er en almindelig kilde til fejl.

Man kan vælge ikke at indlæse hele pakken, men bare bruge en specifik funktion fra en specifik pakke. Dette gøres ved at brug af denne notation `devtools::install_github()`. Som består af pakkenavn og funktionsnavn.

Med den første metode sparer man en del tasteri.

ØVELSE: installer devtools. (skal vi ikke hellere vente til det med bi-plot)


## Funktioner med samme navn
Eftersom der ikke er noget der forhindrer os, eller andre i at lave nye funktioner der hedder det samme som en eksisterende funktion, kan der opstå "konflikter". Når vi indlæser en pakke med library funktionen ser vi ofte en besked om en konflikt, Eksempelvis: `x dplyr::filter() masks stats::filter()`

Det betyder blot at Rs indbyggede pakke `stats` har en funktion der hedder `filter()`. Det har pakken `dplyr` også. Og eftersom `dplyr` er indlæst efter R er startet op, så vil R bruge den sidst indlæste udgave af filter.


Hvis vi har brug for en specifik udgave af en funktion, der kommer fra en bestemt pakke, kan vi kalde den,
eksempelvis: `stats::filter()`

> ## Ét script!
> 
> Som tidligere omtalt, vil vi godt have et samlet script, som kan køre fra start 
> til slut. Og derfor er det god praksis at placere alle `library()` funktionerne 
> i starten af scriptet. Ovenover disse kan man med fordel placere `install.packages()`
> funktionerne (Husk dog at udkommentere disse, da vi ikke ønsker at køre dem 
> hver gang scriptet bliver kørt)
> 
{.callout}

Enkelte pakker er ikke tilgængelige på `CRAN`. Det hyppigste sted vi installerer pakker fra, der ikke findes på CRAN, er Github.

## ggbiplot
Vi kommer ikke her til at bruge tid på biplots. Det er en del af
kurset fødevaredataanalyse, og Morten forklarer bedre end vi 
nogensinde kommer til hvad PCA er og hvad det kan bruges til.

En pakke I kommer til at bruge til at plotte resultaterne af 
en Principal Component Analyse, er `ggbiplot`.

Den ligger ikke på CRAN, men på GitHub, og skal derfor installeres
på en særlig måde: 


~~~
#install.packages("devtools")
#library(devtools)
install_github("vqv/ggbiplot")
~~~
{: .language-r}

Pakken devtools indeholder en funktion; `install_github()`. Den skal
have navnet på det "repository" på GitHub der indeholder pakken.

> ## OBS ved undervisningsmaterialet!
> I undervisningsmaterialet angives en anden måde at 
> installere pakken på:
>
> install_github("ggbiplot", "vqv")
>
> Det udløser en kedelig fejlbesked:
>
> Error in parse_repo_spec(repo) : 
> 
> Invalid git repo specification: 'ggbiplot'
> 
> Hvorfor? Fordi install_github funktionen er blevet opdateret, og 
> nu skal have adressen specificeret på en anden måde.
> Så brug install_github("vqv/ggbiplot") i stedet.
{: .callout}

### Og så kan det fejle på andre måder!
For de fleste brugere af github er det en gratis tjeneste. Det 
fører til begrænsninger. En af dem er hvor mange der kan 
downloade pakker indenfor et bestemt tidsrum. Og den begrænsning
støder nogle af jer på i dette kursus.

Og hvad gør man så når man skal bruge ggbiplot, men ikke kan få
lov at installere pakken?

ggbiplot er en *meget* simpel pakke. Den indeholder en enkelt
funktion. Og den kan vi få adgang til på andre måder.

I jeres projekt laver I mappen `scripts`. Og så kører I denne linie kode, der 
downloader et R-script der indeholder ggbiplot funktion. 


~~~
download.file("https://raw.githubusercontent.com/KUBDatalab/R-refresh-fda/main/code/ggbiplot.R", "scripts/ggbiplot.R")
~~~
{: .language-r}

Derefter kan I, i starten af jeres script, lige efter I ellers har indlæst
biblioteker, sætter I en enkelt linie ind:

~~~
source("scripts/ggbiplot.R")
~~~
{: .language-r}

Og så er der fri adgang til at bruge ggbiplot funktionen fuldstændig
som om den var installeret. 

Husk alligevel at få installeret ggbiplot-pakken ved lejlighed.
Metoden herover fungerer fint, men får ikke hjælpe filer og
andet nyttigt med, så det ér en nødløsning.

# Holde R, RStudio og pakker opdateret.
Det er et stykke tid siden I brugte R sidst. Så nu er der sikkert kommet 
opdateringer.

Det er en god ide at bruge den samme version af R hele vejen gennem dette kursus.
Det er ikke meget avancerede ting I kommer til at lave, så problemet vil næppe
være stort. Men det vil være meget træls at opdatere R dagen før eksamen og finde
ud af at noget er holdt op med at virke.


### Opdater RStudio og opdater R.

R opdaterer vi ganske enkelt ved at installere seneste version.

R studio er også blot at downloade og installere den. Så fungerer tingene.

Husk at når I har opdateret RStudio, og særligt når I har opdateret R, så
vil der sandsynligvis være en del af de pakker I allerede har installeret, der 
skal opdateres.

Vi har under alle omstændigheder behov for at have pakken devtools installeret.
Det betyder at vi kan kalde følgende funktion, der tillader os at vælge 
hvilke der skal opdateres:


~~~
library(devtools)
update_packages()
~~~
{: .language-r}

Vær forberedt på at det godt kan tage en del tid hvis der er mange pakker
der skal installeres.

{% include links.md %}
